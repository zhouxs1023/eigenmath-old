/* Invert a four by four matrix using in line code. */

#include <stdio.h>
#include <stdlib.h>

double a[4][4] = {
	-10.0,	0.0,	0.0,	0.0,
	0.0,	1.0,	7.0,	0.0,
	2.0,	0.0,	1.0,	0.0,
	0.0,	6.0,	0.0,	1.0,
};

main()
{
	int i, j;

	for (i = 0; i < 4; i++)
		for (j = 0; j < 4; j++)
			a[i][j] = random(10);

	printf("begin\n");
	print4(a);

	printf("invert\n");
	invert4(a);
	print4(a);

	printf("invert\n");
	invert4(a);
	print4(a);
}

invert4(a)
double a[4][4];
{
	double d, b[4][4];

	d = 

	- a[0][0] * a[1][1] *a[2][2] * a[3][3]
	+ a[0][0] * a[1][1] *a[2][3] * a[3][2]
	+ a[0][0] * a[2][1] *a[1][2] * a[3][3]
	- a[0][0] * a[2][1] *a[1][3] * a[3][2]
	- a[0][0] * a[3][1] *a[1][2] * a[2][3]
	+ a[0][0] * a[3][1] *a[1][3] * a[2][2]

	+ a[1][0] * a[0][1] * a[2][2] * a[3][3]
	- a[1][0] * a[0][1] * a[2][3] * a[3][2]
	- a[1][0] * a[2][1] * a[0][2] * a[3][3]
	+ a[1][0] * a[2][1] * a[0][3] * a[3][2]
	+ a[1][0] * a[3][1] * a[0][2] * a[2][3]
	- a[1][0] * a[3][1] * a[0][3] * a[2][2]

	- a[2][0] * a[0][1] * a[1][2] * a[3][3]
	+ a[2][0] * a[0][1] * a[1][3] * a[3][2]
	+ a[2][0] * a[1][1] * a[0][2] * a[3][3]
	- a[2][0] * a[1][1] * a[0][3] * a[3][2]
	- a[2][0] * a[3][1] * a[0][2] * a[1][3]
	+ a[2][0] * a[3][1] * a[0][3] * a[1][2]

	+ a[3][0] * a[0][1] * a[1][2] * a[2][3]
	- a[3][0] * a[0][1] * a[1][3] * a[2][2]
	- a[3][0] * a[1][1] * a[0][2] * a[2][3]
	+ a[3][0] * a[1][1] * a[0][3] * a[2][2]
	+ a[3][0] * a[2][1] * a[0][2] * a[1][3]
	- a[3][0] * a[2][1] * a[0][3] * a[1][2];

	b[0][0] =
	- a[1][1] * a[2][2] * a[3][3]
	+ a[1][1] * a[2][3] * a[3][2]
	- a[2][1] * a[1][3] * a[3][2]
	- a[3][1] * a[1][2] * a[2][3]
	+ a[3][1] * a[1][3] * a[2][2]
	+ a[2][1] * a[1][2] * a[3][3];

	b[0][1] =
	+ a[0][1] * a[2][2] * a[3][3]
	- a[0][1] * a[2][3] * a[3][2]
	- a[2][1] * a[0][2] * a[3][3]
	+ a[2][1] * a[0][3] * a[3][2]
	+ a[3][1] * a[0][2] * a[2][3]
	- a[3][1] * a[0][3] * a[2][2];

	b[0][2] =
	- a[0][1] * a[1][2] * a[3][3]
	+ a[0][1] * a[1][3] * a[3][2]
	+ a[1][1] * a[0][2] * a[3][3]
	- a[1][1] * a[0][3] * a[3][2]
	- a[3][1] * a[0][2] * a[1][3]
	+ a[3][1] * a[0][3] * a[1][2];

	b[0][3] =
	+ a[0][1] * a[1][2] * a[2][3]
	- a[0][1] * a[1][3] * a[2][2]
	- a[1][1] * a[0][2] * a[2][3]
	+ a[1][1] * a[0][3] * a[2][2]
	+ a[2][1] * a[0][2] * a[1][3]
	- a[2][1] * a[0][3] * a[1][2];

	b[1][0] =
	+ a[1][0] * a[2][2] * a[3][3]
	- a[1][0] * a[2][3] * a[3][2]
	- a[2][0] * a[1][2] * a[3][3]
	+ a[2][0] * a[1][3] * a[3][2]
	+ a[3][0] * a[1][2] * a[2][3]
	- a[3][0] * a[1][3] * a[2][2];

	b[1][1] =
	- a[0][0] * a[2][2] * a[3][3]
	+ a[0][0] * a[2][3] * a[3][2]
	+ a[2][0] * a[0][2] * a[3][3]
	- a[2][0] * a[0][3] * a[3][2]
	- a[3][0] * a[0][2] * a[2][3]
	+ a[3][0] * a[0][3] * a[2][2];

	b[1][2] =
	+ a[0][0] * a[1][2] * a[3][3]
	- a[0][0] * a[1][3] * a[3][2]
	- a[1][0] * a[0][2] * a[3][3]
	+ a[1][0] * a[0][3] * a[3][2]
	+ a[3][0] * a[0][2] * a[1][3]
	- a[3][0] * a[0][3] * a[1][2];

	b[1][3] =
	- a[0][0] * a[1][2] * a[2][3]
	+ a[0][0] * a[1][3] * a[2][2]
	+ a[1][0] * a[0][2] * a[2][3]
	- a[1][0] * a[0][3] * a[2][2]
	- a[2][0] * a[0][2] * a[1][3]
	+ a[2][0] * a[0][3] * a[1][2];

	b[2][0] =
	- a[1][0] * a[2][1] * a[3][3]
	+ a[1][0] * a[2][3] * a[3][1]
	+ a[2][0] * a[1][1] * a[3][3]
	- a[2][0] * a[1][3] * a[3][1]
	- a[3][0] * a[1][1] * a[2][3]
	+ a[3][0] * a[1][3] * a[2][1];

	b[2][1] =
	+ a[0][0] * a[2][1] * a[3][3]
	- a[0][0] * a[2][3] * a[3][1]
	- a[2][0] * a[0][1] * a[3][3]
	+ a[2][0] * a[0][3] * a[3][1]
	+ a[3][0] * a[0][1] * a[2][3]
	- a[3][0] * a[0][3] * a[2][1];

	b[2][2] =
	- a[0][0] * a[1][1] * a[3][3]
	+ a[0][0] * a[1][3] * a[3][1]
	+ a[1][0] * a[0][1] * a[3][3]
	- a[1][0] * a[0][3] * a[3][1]
	- a[3][0] * a[0][1] * a[1][3]
	+ a[3][0] * a[0][3] * a[1][1];

	b[2][3] =
	- a[0][0] * a[1][3] * a[2][1]
	+ a[0][0] * a[1][1] * a[2][3]
	- a[1][0] * a[0][1] * a[2][3]
	+ a[2][0] * a[0][1] * a[1][3]
	+ a[1][0] * a[0][3] * a[2][1]
	- a[2][0] * a[0][3] * a[1][1];

	b[3][0] =
	+ a[1][0] * a[2][1] * a[3][2]
	- a[1][0] * a[2][2] * a[3][1]
	- a[2][0] * a[1][1] * a[3][2]
	+ a[2][0] * a[1][2] * a[3][1]
	+ a[3][0] * a[1][1] * a[2][2]
	- a[3][0] * a[1][2] * a[2][1];

	b[3][1] =
	- a[0][0] * a[2][1] * a[3][2]
	+ a[0][0] * a[2][2] * a[3][1]
	+ a[2][0] * a[0][1] * a[3][2]
	- a[2][0] * a[0][2] * a[3][1]
	- a[3][0] * a[0][1] * a[2][2]
	+ a[3][0] * a[0][2] * a[2][1];

	b[3][2] =
	+ a[0][0] * a[1][1] * a[3][2]
	- a[0][0] * a[1][2] * a[3][1]
	+ a[3][0] * a[0][1] * a[1][2]
	- a[1][0] * a[0][1] * a[3][2]
	- a[3][0] * a[0][2] * a[1][1]
	+ a[1][0] * a[0][2] * a[3][1];

	b[3][3] =
	- a[0][0] * a[1][1] * a[2][2]
	+ a[0][0] * a[1][2] * a[2][1]
	+ a[1][0] * a[0][1] * a[2][2]
	- a[1][0] * a[0][2] * a[2][1]
	- a[2][0] * a[0][1] * a[1][2]
	+ a[2][0] * a[0][2] * a[1][1];

	a[0][0] = b[0][0] / d;
	a[0][1] = b[0][1] / d;
	a[0][2] = b[0][2] / d;
	a[0][3] = b[0][3] / d;

	a[1][0] = b[1][0] / d;
	a[1][1] = b[1][1] / d;
	a[1][2] = b[1][2] / d;
	a[1][3] = b[1][3] / d;

	a[2][0] = b[2][0] / d;
	a[2][1] = b[2][1] / d;
	a[2][2] = b[2][2] / d;
	a[2][3] = b[2][3] / d;

	a[3][0] = b[3][0] / d;
	a[3][1] = b[3][1] / d;
	a[3][2] = b[3][2] / d;
	a[3][3] = b[3][3] / d;
}

print4(a)
double a[4][4];
{
	int i, j;
	for (i = 0; i < 4; i++) {
		for (j = 0; j < 4; j++)
			printf("%15g", a[i][j]);
		printf("\n");
	}
}
